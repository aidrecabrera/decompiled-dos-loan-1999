// 1999_SOFT_LOAN__208F.c
// Generated by decompiling 1999_SOFT_LOAN_.exe
// using Reko decompiler version 0.11.4.0.

#include "1999_SOFT_LOAN_.h"

Eq_133 g_t208F0 = // 000208F0
	{
		&g_tFFFF9A06
	};
// 208F:000C: define fn208F_000C
// Called from:
//      fn21DC_0EC2
define fn208F_000C
{
	sp = fp;
	Top = 0;
	sp -= 2;
	ss->*sp = bp;
	sp -= 2;
	ss->*sp = si;
	sp -= 2;
	ss->*sp = di;
	bp = sp;
	Mem0[ds:0x10CA:word16] = 0x00;
	ah = 0x30;
	al = msdos_get_dos_version(out ah);
	SCZO = cond(al - 0x00);
	if (Test(EQ,Z))
		ax = 0x01;
	bl = ah;
	bh = 0x00;
	ah = 100;
	ax = ah *16 al;
	ax += bx;
	Mem0[ds:0x10CE:word16] = ax;
	SCZO = cond(ax - 300);
	if (Test(ULT,C))
		Mem0[ds:0x10D0:byte] = 0x07;
	else
	{
		sp -= 2;
		ss->*sp = ds;
		ah = 0x25;
		al = 0x24;
		dx.u0 = 8335;
		ds = dx;
		dx.u0 = 0x0229;
		msdos_set_interrupt_vector(al, ds_dx);
		ds = ss->*sp;
		sp = (word16) sp + 2;
		Mem0[ds:0x10D0:byte] = ~0x00;
	}
	di = ss->*sp;
	sp = (word16) sp + 2;
	si = ss->*sp;
	sp = (word16) sp + 2;
	bp = ss->*sp;
	sp = (word16) sp + 2;
}

// 208F:00AE: define fn208F_00AE
// Called from:
//      fn20B2_1192
//      fn21DC_04BA
//      fn2644_0F82
//      fn2EB3_0002
define fn208F_00AE
{
	selector ds;
	byte al;
	word16 wArg04;
	Top_3 = 0;
	ds->w10CA = 0x00;
	bx_18 = wArg04;
	C_19 = msdos_close_file(wArg04);
	ax_21 = SEQ(0x3E, al);
	if (!C_19)
		ds->w10CA = ax_21;
}

// 208F:00C9: define fn208F_00C9
// Called from:
//      fn2644_20AA
//      fn2B41_0006
//      fn2B9C_000C
//      fn2B9C_009C
//      fn2D1A_0186
//      fn2D1A_0598
//      fn2E37_04CE
//      fn2E37_05C0
//      fn2EB3_0A8C
define fn208F_00C9
{
	selector ds;
	word16 wArg04;
	segptr32 ptrArg06;
	word16 wArg0A;
	Top_3 = 0;
	ds->w10CA = 0x00;
	bx_20 = wArg04;
	dx_24 = (word16) ptrArg06;
	cx_22 = wArg0A;
	C_26 = msdos_read_file(wArg04, wArg0A, ptrArg06, out ax_25);
	if (!C_26)
	{
		ds->w10CA = ax_25;
		ax_30 = 0x00;
	}
	ax_50 = ϕ(ax_25, ax_30);
}

// 208F:00EF: define fn208F_00EF
// Called from:
//      fn21DC_04BA
//      fn2644_0D70
//      fn2644_21CA
//      fn2644_45CA
//      fn2B41_0052
//      fn2D1A_003C
//      fn2D1A_064E
//      fn2E37_0096
//      fn2EB3_0AFA
define fn208F_00EF
{
	selector ds;
	word16 wArg04;
	segptr32 ptrArg06;
	word16 wArg0A;
	Top_3 = 0;
	ds->w10CA = 0x00;
	bx_20 = wArg04;
	dx_24 = (word16) ptrArg06;
	cx_22 = wArg0A;
	C_26 = msdos_write_file(wArg04, wArg0A, ptrArg06, out ax_25);
	if (!C_26)
	{
		ds->w10CA = ax_25;
		ax_30 = 0x00;
	}
	ax_50 = ϕ(ax_25, ax_30);
}

// 208F:0115: define fn208F_0115
// Called from:
//      fn2644_0D70
//      fn2644_2068
//      fn2644_20AA
//      fn2644_21CA
//      fn2644_45CA
//      fn2B9C_000C
//      fn2B9C_009C
//      fn2D1A_003C
//      fn2D1A_0186
//      fn2E37_0096
//      fn2E37_04CE
//      fn2E37_05C0
//      fn2EB3_0A8C
//      fn2EB3_0AFA
//      fn2EB3_0B54
define fn208F_0115
{
	word32 dwArg06;
	selector ds;
	word16 wArg04;
	wArg08 = SLICE(dwArg06, word16, 16);
	byte bArg0A;
	Top_3 = 0;
	ds->w10CA = 0x00;
	cx_20 = wArg08;
	cx_dx_22 = dwArg06;
	C_24 = msdos_set_file_position(wArg04, cx_dx_22, bArg0A, out dx_ax_23);
	ax_25 = (word16) dx_ax_23;
	dx_32 = SLICE(dx_ax_23, word16, 16);
	if (!C_24)
	{
		ds->w10CA = ax_25;
		ax_27 = 0x00;
		dx_28 = 0x00;
	}
	dx_31 = ϕ(dx_32, dx_28);
	ax_29 = ϕ(ax_25, ax_27);
	bx_30 = ax_29;
	ax_38 = ax_29;
	dx_39 = dx_31;
}

// 208F:0147: define fn208F_0147
// Called from:
//      fn207F_0006
//      fn207F_0048
//      fn207F_0088
//      fn207F_00D2
define fn208F_0147
{
	sp = fp;
	Top = 0;
	sp -= 2;
	(ss->*sp).ptr0000 = (struct Eq_50254 Eq_50261::*) bp;
	sp -= 2;
	(ss->*sp).ptr0000 = (struct Eq_50254 Eq_50261::*) si;
	sp -= 2;
	(ss->*sp).ptr0000 = (struct Eq_50254 Eq_50261::*) di;
	bp = sp;
	ds->w10CA = 0x00;
	ah = 0x5C;
	bx = (ss->*bp).w000A;
	dx = (ss->*bp).w000C;
	cx = (ss->*bp).w000E;
	di = (struct Eq_50254 Eq_50261::*) (ss->*bp).ptr0010;
	si = (struct Eq_50254 Eq_50261::*) (ss->*bp).ptr0012;
	al = (ss->*bp).b0014;
	__syscall<byte>(33);
	if (Test(ULT,C))
	{
		ds->w10CA = ax;
		SCZO = cond(ax - 33);
		ax = 0x00;
		if (Test(EQ,Z))
		{
l208F_0178:
			di = (struct Eq_50254 Eq_50261::*) (ss->*sp).ptr0000;
			sp = (struct Eq_50254 Eq_50261::*) &sp->ptr0000;
			si = (struct Eq_50254 Eq_50261::*) (ss->*sp).ptr0000;
			sp = (struct Eq_50254 Eq_50261::*) &sp->ptr0000;
			bp = (struct Eq_50254 Eq_50261::*) (ss->*sp).ptr0000;
			sp = (struct Eq_50254 Eq_50261::*) &sp->ptr0000;
			return;
		}
	}
	ax = 0x01;
	goto l208F_0178;
}

// 208F:01E6: define fn208F_01E6
// Called from:
//      fn21DC_0EC2
define fn208F_01E6
{
	sp = fp;
	Top = 0;
	sp -= 2;
	(ss->*sp).ptr0000 = (struct Eq_50350 Eq_50357::*) bp;
	sp -= 2;
	(ss->*sp).ptr0000 = (struct Eq_50350 Eq_50357::*) si;
	sp -= 2;
	(ss->*sp).ptr0000 = (struct Eq_50350 Eq_50357::*) di;
	bp = sp;
	ds->w10CA = 0x00;
	dx = 0x01;
	SCZO = cond(ds->w10CE - 330);
	if (Test(UGE,C))
	{
		ah = 0x67;
		bx = (ss->*bp).w000A;
		C = msdos_set_handle_count(bx, out ax);
		if (Test(ULT,C))
		{
			ds->w10CA = ax;
			dx = 0x00;
		}
	}
	ax = dx;
	di = (struct Eq_50350 Eq_50357::*) (ss->*sp).ptr0000;
	sp = (struct Eq_50350 Eq_50357::*) &sp->ptr0000;
	si = (struct Eq_50350 Eq_50357::*) (ss->*sp).ptr0000;
	sp = (struct Eq_50350 Eq_50357::*) &sp->ptr0000;
	bp = (struct Eq_50350 Eq_50357::*) (ss->*sp).ptr0000;
	sp = (struct Eq_50350 Eq_50357::*) &sp->ptr0000;
}

